"use strict";var vapormall=(()=>{var N=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var R=(n,e)=>{for(var s in e)N(n,s,{get:e[s],enumerable:!0})},C=(n,e,s,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of I(e))!P.call(n,i)&&i!==s&&N(n,i,{get:()=>e[i],enumerable:!(a=O(e,i))||a.enumerable});return n};var D=n=>C(N({},"__esModule",{value:!0}),n);var _={};R(_,{Battle:()=>p,CONSTANTS:()=>t,GameState:()=>L,IndividualSoul:()=>E,Manager:()=>k,SKILL_LIST:()=>m,SOUL_LIST:()=>g,Skill:()=>h});var t;(i=>{let n;(c=>(c.HP="HP",c.OFFENSE="offense",c.DEFENSE="defense",c.GLITCHOFFENSE="glitch offense",c.GLITCHDEFENSE="glitch defense",c.SPEED="speed"))(n=i.STATS||={});let e;(S=>(S.NORMALDAMAGE="normal damage",S.GLITCHDAMAGE="glitch damage",S.STATUS="status"))(e=i.SKILLCATEGORIES||={});let s;(c=>(c.TYPELESS="typeless",c.SWEET="sweet",c.EDGE="edge",c.CORPORATE="corporate",c.SANGFROID="sangfroid",c.ERROR="error"))(s=i.TYPES||={});let a;(o=>(o[o.SELECTED=0]="SELECTED",o[o.OPPOSING=1]="OPPOSING",o[o.ALLIED=2]="ALLIED",o[o.ALLY=3]="ALLY",o[o.ALL=4]="ALL",o[o.SELF=5]="SELF",o[o.NONE=6]="NONE"))(a=i.TARGETS||={})})(t||={});var m={basic_attack:{name:"Attack",description:"Basic attack.",power:4,max_pp:30,priority:0,stat_changes:[],target:t.TARGETS.SELECTED,type:t.TYPES.TYPELESS,meta:{category:t.SKILLCATEGORIES.NORMALDAMAGE,crit_rate:0,drain:0,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}},recoil:{name:"Recoil",description:"Restores half the damage dealt.",power:12,max_pp:15,priority:0,stat_changes:[],target:t.TARGETS.SELECTED,type:t.TYPES.ERROR,meta:{category:t.SKILLCATEGORIES.NORMALDAMAGE,crit_rate:0,drain:-33,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}},drain:{name:"Drain",description:"Restores half the damage dealt.",power:4,max_pp:20,priority:0,stat_changes:[],target:t.TARGETS.SELECTED,type:t.TYPES.TYPELESS,meta:{category:t.SKILLCATEGORIES.NORMALDAMAGE,crit_rate:0,drain:50,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}},dazzling_polish:{name:"Dazzling Polish",description:"Polish simulated aesthetics for enhanced beauty. Raise Offense, Glitch Offense.",power:null,max_pp:15,priority:0,stat_changes:[{change:1,stat:t.STATS.OFFENSE,target:t.TARGETS.SELF},{change:1,stat:t.STATS.GLITCHOFFENSE,target:t.TARGETS.SELF}],target:t.TARGETS.SELF,type:t.TYPES.SWEET,meta:{category:t.SKILLCATEGORIES.STATUS,crit_rate:0,drain:0,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}}};var g={Adware:{name:"ADWARE",description:"Churning glut of incoherence.",stats:{[t.STATS.HP]:20,[t.STATS.OFFENSE]:10,[t.STATS.DEFENSE]:10,[t.STATS.GLITCHOFFENSE]:10,[t.STATS.GLITCHDEFENSE]:7,[t.STATS.SPEED]:8},sprites:{front:"temp.gif",back:"temp.gif"},types:[t.TYPES.ERROR],levelUp:[{level:1,learnedSkills:[m.basic_attack,m.dazzling_polish,m.drain,m.recoil]},{level:2,statChanges:[{stat:t.STATS.SPEED,change:6}]},{level:3,statChanges:[{stat:t.STATS.DEFENSE,change:6}]},{level:4,statChanges:[{stat:t.STATS.HP,change:6}]},{level:5,statChanges:[{stat:t.STATS.GLITCHDEFENSE,change:3},{stat:t.STATS.DEFENSE,change:3}]}]}};var f=class{constructor(e){this.soul=e,this.selected_skill=null,this.selected_target=null,this.infoDiv=document.createElement("div");let s=document.createTextNode(this.soul.name);this.infoDiv.append(s),this.infoDiv.append(document.createElement("br")),this.displayHP=this.soul.currentHP,this.hpText=document.createElement("small"),this.hpText.append(document.createTextNode(this.getHPString())),this.infoDiv.append(this.hpText),document.getElementById("tophalf")?.append(this.infoDiv),this.stat_changes={[t.STATS.HP]:-1,[t.STATS.OFFENSE]:0,[t.STATS.DEFENSE]:0,[t.STATS.GLITCHOFFENSE]:0,[t.STATS.GLITCHDEFENSE]:0,[t.STATS.SPEED]:0}}updateInfo(){this.hpText.innerHTML=this.getHPString()}getHPString(){return"HP: "+this.displayHP+"/"+this.soul.stats[t.STATS.HP]}calculateStat(e){let s=this.soul.stats[e],a;return this.stat_changes[e]>0?a=(2+this.stat_changes[e])/2:a=2/(2-this.stat_changes[e]),Math.max(Math.floor(s*a),1)}},u=class extends f{constructor(e){super(e),this.infoDiv.classList.add("playerInfo","soulInfo","blackBg")}},T=class extends f{constructor(e){super(e),this.infoDiv.classList.add("enemyInfo","soulInfo","blackBg")}chooseMove(e,s,a){console.log(this.soul.skills);let i=Math.floor(Math.random()*this.soul.skills.length);switch(this.selected_skill=this.soul.skills[i],this.selected_skill.data.target){case t.TARGETS.SELECTED:case t.TARGETS.OPPOSING:let l=Math.floor(Math.random()*s.length);this.selected_target=[s[l]];break;case t.TARGETS.ALLIED:case t.TARGETS.ALLY:case t.TARGETS.SELF:this.selected_target=[this];break;case t.TARGETS.ALL:case t.TARGETS.NONE:break}}};function y(n){return n.charAt(0).toUpperCase()+n.slice(1)}var A=class n{static{this.ENDBLOCK_STRING="ENDBLOCK"}constructor(e){let s=document.getElementById("messageContainer");if(s===null){console.error("messageContainer is null! Cannot display messages!");return}this.messages=[],this.messageContainer=s,this.blocks=0,this.timeouts=[],this.skillHandlerCreator=e}addMessage(e){this.messages.push(e)}endMessageBlock(){this.messages.push(n.ENDBLOCK_STRING)}displayMessages(){let e=0;this.messages.forEach((s,a)=>{s===n.ENDBLOCK_STRING&&(this.enqueueBlock(this.messages.slice(e,a)),e=a+1)}),this.enqueueBlock(this.messages.slice(e,this.messages.length)),this.messages=[]}enqueueBlock(e){let s=this.blocks*3100,a=setTimeout(()=>{this.displayBlock(e)},s);this.timeouts.push(a),this.blocks++}displayBlock(e){let s=document.createElement("div");s.classList.add("message","blackBg"),this.messageContainer.append(s);let a=0;e.forEach((l,r)=>{let d=a*750;if(typeof l=="string"){let S=setTimeout(()=>{s.append(document.createTextNode(y(l))),s.append(document.createElement("br"))},d);this.timeouts.push(S),a++}else{let S=setTimeout(()=>{l()},d);this.timeouts.push(S)}});let i=setTimeout(()=>{s.remove(),this.blocks--},e.length*750);this.timeouts.push(i)}renderSkills(e){let s=[],a=document.createElement("div");a.id="skillContainer";let i=document.createElement("p");i.textContent="AGGRESSION PROTOCOL INITIATED.",a.append(i),e.soul.skills.forEach((l,r)=>{let d=this.makeSkillWrapper(e,l,r);a?.append(d)}),document.getElementById("bottomhalf")?.append(a)}makeSkillWrapper(e,s,a){let i=s.getSkillButton();s.pp>0?i.addEventListener("click",this.skillHandlerCreator(e,a),!1):i.classList.add("noClick");let l=s.getSkillTip();i.onmouseover=function(){l.style.display="block"},i.onmouseout=function(){l.style.display="none"};let r=document.createElement("div");return r.classList.add("skill-wrapper"),r.append(i),r.append(l),r}temporaryHideSkills(e){document.getElementById("skillContainer")?.remove();let a=setTimeout(()=>{this.renderSkills(e)},3100*2);this.timeouts.push(a)}endBattle(){document.getElementById("endScreen")?.classList.remove("hidden")}};var p=class n{constructor(e,s){this.playerSouls=e.map(function(i){return new u(i)}),this.enemySouls=s.map(function(i){return new T(i)}),this.souls=[...this.playerSouls,...this.enemySouls],this.battleOver=!1,this.messageRenderer=new A(this.createSkillClickHandler.bind(this));let a=this.playerSouls[0];this.messageRenderer.renderSkills(a)}static getName(e){return e instanceof u?"your "+e.soul.name:"the opposing "+e.soul.name}passTurn(){function e(a,i){return a.calculateStat(t.STATS.SPEED)-i.calculateStat(t.STATS.SPEED)}let s=this.souls.sort(e);for(let a=0;a<s.length;a++)this.useSkill(s[a])}checkBattleOver(){(this.playerSouls.length===0||this.enemySouls.length===0)&&(this.messageRenderer.endMessageBlock(),this.playerSouls.length,this.messageRenderer.addMessage(()=>{this.messageRenderer.endBattle()}))}selectEnemySkills(){for(let e of this.enemySouls)e.chooseMove(this.souls,this.playerSouls,this.enemySouls)}selectPlayerTarget(e){if(e.selected_skill===null){console.error("SELECTING TARGET FOR NULL PLAYER SKILL");return}switch(e.selected_skill.data.target){case t.TARGETS.SELECTED:case t.TARGETS.OPPOSING:e.selected_target=[this.enemySouls[0]];break;case t.TARGETS.ALLIED:e.selected_target=this.playerSouls;break;case t.TARGETS.ALLY:break;case t.TARGETS.ALL:e.selected_target=this.souls;break;case t.TARGETS.SELF:e.selected_target=[e];break;case t.TARGETS.NONE:e.selected_target=[];break}}createSkillClickHandler(e,s){return()=>{e.selected_skill=e.soul.skills[s],this.messageRenderer.temporaryHideSkills(e),this.selectPlayerTarget(e),this.selectEnemySkills(),this.passTurn(),this.messageRenderer.displayMessages()}}useSkill(e){let s=e.selected_skill;if(s===null){console.error("Using null skill!");return}if(s.pp<=0){console.error("Using skill with no pp!");return}switch(s.pp--,s.data.target){case t.TARGETS.SELECTED:case t.TARGETS.OPPOSING:case t.TARGETS.ALLIED:case t.TARGETS.ALLY:case t.TARGETS.ALL:case t.TARGETS.SELF:e.selected_target!==null?e.selected_target.forEach(a=>{this.applySkillEffects(e,s,a)}):console.error("No target for move!");break;case t.TARGETS.NONE:break}}applySkillEffects(e,s,a){switch(this.messageRenderer.addMessage(n.getName(e)+" used "+s.data.name+"!"),s.data.meta.category){case t.SKILLCATEGORIES.NORMALDAMAGE:case t.SKILLCATEGORIES.GLITCHDAMAGE:if(s.data.power!==null){let i=this.damageCalc(e,s,a,s.data.meta.category===t.SKILLCATEGORIES.GLITCHDAMAGE),l=1;if(a.soul.soul_species.types.forEach(r=>{l*=this.typeMultiplier(s.data.type,r)}),l===0)this.messageRenderer.addMessage("It didn't affect "+n.getName(a)+"...");else if(i=Math.ceil(i*l),this.messageRenderer.addMessage(()=>{a.displayHP-=i,a.updateInfo()}),l>1?this.messageRenderer.addMessage("It's super effective!"):l<1&&this.messageRenderer.addMessage("It's not very effective..."),this.messageRenderer.addMessage(n.getName(a)+" lost "+i+" HP!"),a.soul.changeHP(-i),this.checkFaint(a),s.data.meta.drain!==0){let r=Math.floor(i*(s.data.meta.drain/100));this.messageRenderer.addMessage(()=>{e.displayHP+=r,e.updateInfo()}),r>0?this.messageRenderer.addMessage(n.getName(e)+" drained "+r+" HP!"):r<0&&this.messageRenderer.addMessage(n.getName(e)+" lost "+-r+" HP from recoil!"),e.soul.changeHP(r),this.checkFaint(e)}}break;case t.SKILLCATEGORIES.STATUS:s.data.stat_changes.forEach(i=>{if(i.stat===t.STATS.HP)console.error("Stat change for HP not allowed!");else if(a.stat_changes[i.stat]===6)this.messageRenderer.addMessage(n.getName(a)+"'s "+i.stat+" couldn't go any higher!");else if(a.stat_changes[i.stat]===-6)this.messageRenderer.addMessage(n.getName(a)+"'s "+i.stat+" couldn't go any lower!");else{a.stat_changes[i.stat]+=i.change;let l=" ";i.change>0?l+="rose":l+="fell",i.change>1?l+=" "+Math.abs(i.change)+" stages!":l+=" "+Math.abs(i.change)+" stage!",this.messageRenderer.addMessage(n.getName(a)+"'s "+i.stat+l)}});break}this.messageRenderer.endMessageBlock()}checkFaint(e){e.soul.currentHP<=0&&(this.messageRenderer.endMessageBlock(),this.messageRenderer.addMessage(n.getName(e)+" was destroyed!"),this.souls.splice(this.souls.indexOf(e),1),e instanceof u?this.playerSouls.splice(this.playerSouls.indexOf(e),1):e instanceof T&&this.enemySouls.splice(this.enemySouls.indexOf(e),1),this.checkBattleOver())}damageCalc(e,s,a,i){if(i){let d=e.calculateStat(t.STATS.GLITCHOFFENSE)*s.data.power;return Math.ceil(d/a.calculateStat(t.STATS.GLITCHDEFENSE))}let l=e.calculateStat(t.STATS.OFFENSE)*s.data.power;return Math.ceil(l/a.calculateStat(t.STATS.DEFENSE))}typeMultiplier(e,s){switch(e){case t.TYPES.TYPELESS:if(s===t.TYPES.ERROR)return 0;break;case t.TYPES.SWEET:if(s===t.TYPES.CORPORATE)return 2;if(s===t.TYPES.EDGE)return .5;break;case t.TYPES.EDGE:if(s===t.TYPES.SWEET)return 2;if(s===t.TYPES.SANGFROID)return .5;break;case t.TYPES.CORPORATE:if(s===t.TYPES.SANGFROID)return 2;if(s===t.TYPES.SWEET)return .5;break;case t.TYPES.SANGFROID:if(s===t.TYPES.EDGE)return 2;if(s===t.TYPES.CORPORATE)return .5;break}return 1}};var h=class{constructor(e){this.data=e,this.pp=e.max_pp}getSkillButton(){let e=document.createElement("button");e.classList.add("skill-button","skill-div");let s="skill-"+this.data.type;e.classList.add(s);let a=document.createTextNode(this.data.name);e.append(a),e.append(document.createElement("br"));let i=document.createElement("small");i.append(document.createTextNode(this.data.type+" ")),e.append(i);let l=document.createElement("small");return l.append(document.createTextNode(this.pp+"/"+this.data.max_pp)),e.append(l),e}getSkillTip(){let e=document.createElement("div");e.classList.add("skill-tip","skill-div");let s=document.createTextNode(this.data.name);e.append(s),e.append(document.createElement("br"));let a=document.createElement("small");a.append(document.createTextNode(this.data.type+" ")),e.append(a);let i=document.createElement("small");if(i.append(document.createTextNode(this.data.meta.category+" ")),e.append(i),e.append(document.createElement("hr")),this.data.power!==null){let r=document.createElement("small");r.append(document.createTextNode("Power: "+this.data.power)),e.append(r),e.append(document.createElement("hr"))}let l=document.createElement("small");return l.append(document.createTextNode(this.data.description)),e.append(l),e}};var E=class{constructor(e,s){this.soul_species=e,this.name=e.name,this.level=s,this.skills=[],this.stats={[t.STATS.HP]:0,[t.STATS.OFFENSE]:0,[t.STATS.DEFENSE]:0,[t.STATS.GLITCHOFFENSE]:0,[t.STATS.GLITCHDEFENSE]:0,[t.STATS.SPEED]:0},this.initializeStats(),this.levelUpSimulate(),this.currentHP=this.stats[t.STATS.HP]}initializeStats(){for(let e in this.stats){let s=e;this.stats[s]=this.soul_species.stats[s]}}levelUpSimulate(){let e=0;this.soul_species.levelUp.filter(s=>s.level<=this.level).forEach((s,a)=>{s.statChanges!==void 0&&s.statChanges.forEach(i=>{this.stats[i.stat]+=i.change}),s.learnedSkills!==void 0&&s.learnedSkills.forEach(i=>{this.skills[e]=new h(i),e=++e%4})})}changeHP(e){this.currentHP=Math.min(this.stats[t.STATS.HP],this.currentHP+e),this.currentHP=Math.max(0,this.currentHP)}changeName(e){this.name=e}};var L=class{constructor(){this.partySouls=[]}addSoul(e){this.partySouls.push(e)}removeSoul(e){this.partySouls.splice(this.partySouls.indexOf(e),1)}};var k=class n{static startBattle(e){let s=e.partySouls[0],a=n.generateEnemy();return new p([s],[a])}static generateEnemy(){return new E(g.Adware,1)}};return D(_);})();
