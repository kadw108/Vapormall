"use strict";var vapormall=(()=>{var g=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var N=(n,e)=>{for(var t in e)g(n,t,{get:e[t],enumerable:!0})},A=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of b(e))!y.call(n,i)&&i!==t&&g(n,i,{get:()=>e[i],enumerable:!(s=T(e,i))||s.enumerable});return n};var I=n=>A(g({},"__esModule",{value:!0}),n);var O={};N(O,{Battle:()=>u,CONSTANTS:()=>l,IndividualSoul:()=>p,SKILL_LIST:()=>m,SOUL_LIST:()=>L});var l;(i=>{let n;(a=>(a[a.HP=0]="HP",a[a.OFFENSE=1]="OFFENSE",a[a.DEFENSE=2]="DEFENSE",a[a.GLITCHOFFENSE=3]="GLITCHOFFENSE",a[a.GLITCHDEFENSE=4]="GLITCHDEFENSE",a[a.SPEED=5]="SPEED"))(n=i.STATS||={});let e;(c=>(c[c.NORMALDAMAGE=0]="NORMALDAMAGE",c[c.GLITCHDAMAGE=1]="GLITCHDAMAGE",c[c.STATUS=2]="STATUS"))(e=i.SKILLCATEGORIES||={});let t;(a=>(a.TYPELESS="typeless",a.SWEET="sweet",a.EDGE="edge",a.CORPORATE="corporate",a.SANGFROID="sangfroid",a.ERROR="error"))(t=i.TYPES||={});let s;(r=>(r[r.SELECTED=0]="SELECTED",r[r.OPPOSING=1]="OPPOSING",r[r.ALLIED=2]="ALLIED",r[r.ALLY=3]="ALLY",r[r.ALL=4]="ALL",r[r.SELF=5]="SELF",r[r.NONE=6]="NONE"))(s=i.TARGETS||={})})(l||={});var m={basic_attack:{name:"Attack",description:"Basic attack.",power:4,max_pp:30,priority:0,stat_changes:[],target:l.TARGETS.SELECTED,type:l.TYPES.TYPELESS,meta:{category:l.SKILLCATEGORIES.NORMALDAMAGE,crit_rate:0,drain:0,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}},dazzling_polish:{name:"Dazzling Polish",description:"Polish simulated aesthetics for enhanced beauty. Raise Offense, Glitch Offense.",power:null,max_pp:15,priority:0,stat_changes:[{change:1,stat:l.STATS.OFFENSE},{change:1,stat:l.STATS.GLITCHOFFENSE}],target:l.TARGETS.SELF,type:l.TYPES.SWEET,meta:{category:l.SKILLCATEGORIES.STATUS,crit_rate:0,drain:0,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}}};var L={Adware:{name:"ADWARE",description:"Churning glut of incoherence.",stats:[{stat:l.STATS.HP,starting_stat:20},{stat:l.STATS.OFFENSE,starting_stat:3},{stat:l.STATS.DEFENSE,starting_stat:10},{stat:l.STATS.GLITCHOFFENSE,starting_stat:10},{stat:l.STATS.GLITCHDEFENSE,starting_stat:7},{stat:l.STATS.SPEED,starting_stat:8}],sprites:{front:"temp.gif",back:"temp.gif"},types:[l.TYPES.ERROR],skills:[{skill_meta:m.basic_attack,learned_at:0},{skill_meta:m.dazzling_polish,learned_at:0}]}};var k=class{constructor(e){this.data=e,this.pp=e.max_pp}renderSkillButton(){let e=document.createElement("button");e.classList.add("skill-button");let t=document.createTextNode(this.data.name);e.append(t),e.append(document.createElement("br"));let s=document.createElement("small");s.append(document.createTextNode(this.data.type+" ")),e.append(s);let i=document.createElement("small");return i.append(document.createTextNode(this.pp+"/"+this.data.max_pp)),e.append(i),e}},p=class{constructor(e,t){this.soul_species=e,this.name=e.name,this.level=t,this.initializeStats(),this.skills=[],this.initializeSkills()}initializeStats(){this.max_hp=this.soul_species.stats[0].starting_stat,this.hp=this.max_hp,this.offense=this.soul_species.stats[1].starting_stat,this.defense=this.soul_species.stats[2].starting_stat,this.glitch_offense=this.soul_species.stats[3].starting_stat,this.glitch_defense=this.soul_species.stats[4].starting_stat,this.speed=this.soul_species.stats[5].starting_stat}initializeSkills(){for(let e=0;e<this.soul_species.skills.length;e++){let t=this.soul_species.skills[e];t.learned_at<=this.level&&this.skills.push(new k(t.skill_meta))}}},h=class{constructor(e){this.soul=e,this.selected_skill=null,this.selected_target=null,this.infoDiv=document.createElement("div");let t=document.createTextNode(this.soul.name);this.infoDiv.append(t),this.infoDiv.append(document.createElement("br")),this.hpText=document.createElement("small"),this.hpText.append(document.createTextNode(this.getHPString())),this.infoDiv.append(this.hpText),document.getElementById("tophalf")?.append(this.infoDiv)}useSkill(e){if(this.selected_skill===null){console.error("Using null skill!");return}if(this.selected_skill.pp<=0){console.error("Using skill with no pp!");return}this.selected_skill.pp--;let t=[u.getName(this)+" used "+this.selected_skill.data.name],s=this.selected_skill;switch(s.data.meta.category){case l.SKILLCATEGORIES.NORMALDAMAGE:if(s.data.power!==null){let i=this.soul.offense*s.data.power;if(this.selected_target!==null)for(let o=0;o<this.selected_target.length;o++){let d=this.selected_target[o],f=Math.ceil(i/d.soul.defense);d.soul.hp-=f,t.push(u.getName(d)+" lost "+f+" HP!"),e.addBlock(t),d.updateInfo()}else console.error("No target for move!")}break;case l.SKILLCATEGORIES.GLITCHDAMAGE:break;case l.SKILLCATEGORIES.STATUS:break;default:console.log("SKILL HAS INVALID CATEGORY")}}updateInfo(){this.hpText.innerHTML=this.getHPString()}getHPString(){return"HP: "+this.soul.hp+"/"+this.soul.max_hp}},S=class extends h{constructor(e){super(e),this.infoDiv.classList.add("playerInfo","soulInfo","blackBg")}renderSkills(e){let t=document.createElement("div");t.id="skillDiv",this.soul.skills.forEach((s,i)=>{let o=s.renderSkillButton();o.addEventListener("click",e.makeSkillClickHandler(this,i),!1),t?.append(o)}),document.getElementById("bottomhalf")?.append(t)}hideSkills(){document.getElementById("skillDiv")?.remove()}},E=class extends h{constructor(e){super(e),this.infoDiv.classList.add("enemyInfo","soulInfo","blackBg")}},u=class{constructor(e,t){this.playerSouls=e.map(function(s){return new S(s)}),this.enemySouls=t.map(function(s){return new E(s)}),this.souls=[...this.playerSouls,...this.enemySouls],this.battleOver=!1,this.messageRenderer=new _}static getName(e){return e instanceof S?"Your "+e.soul.name:"The opposing "+e.soul.name}render(){this.playerSouls[0].renderSkills(this)}passTurn(){function e(s,i){return s.soul.speed-i.soul.speed}let t=this.souls.sort(e);for(let s=0;s<t.length;s++)if(t[s].useSkill(this.messageRenderer),this.checkBattleOver(),this.battleOver)return}checkBattleOver(){let e=!0;for(let s=0;s<this.playerSouls.length;s++)if(this.playerSouls[s].soul.hp>0){e=!1;break}e&&(this.messageRenderer.addBlock(["u lose lol"]),this.battleOver=!0);let t=!0;for(let s=0;s<this.enemySouls.length;s++)if(this.enemySouls[s].soul.hp>0){t=!1;break}t&&(this.messageRenderer.addBlock(["u win!"]),this.battleOver=!0)}selectEnemySkills(){for(let e of this.enemySouls)e.selected_skill=e.soul.skills[0],e.selected_target=[this.playerSouls[0]]}selectPlayerTarget(e){if(e.selected_skill===null){console.error("SELECTING TARGET FOR NULL PLAYER SKILL");return}switch(e.selected_skill.data.target){case l.TARGETS.SELECTED:case l.TARGETS.OPPOSING:e.selected_target=[this.enemySouls[0]];break;case l.TARGETS.ALLIED:e.selected_target=this.playerSouls;break;case l.TARGETS.ALLY:break;case l.TARGETS.ALL:e.selected_target=this.souls;break;case l.TARGETS.SELF:e.selected_target=[e];break;case l.TARGETS.NONE:e.selected_target=[];break}}makeSkillClickHandler(e,t){return()=>{e.hideSkills(),e.selected_skill=e.soul.skills[t],this.selectPlayerTarget(e),this.selectEnemySkills(),this.passTurn(),setTimeout(()=>{e.renderSkills(this)},3e3*2)}}};var _=class{constructor(){let e=document.getElementById("messageContainer");if(e===null){console.error("messageContainer is null! Cannot display messages!");return}this.messageContainer=e,this.blocks=0}addBlock(e){let t=this.blocks*3e3;setTimeout(()=>{this.renderBlock(e)},t),this.blocks++}renderBlock(e){let t=document.createElement("div");t.classList.add("message","blackBg"),this.messageContainer.append(t);for(let s=0;s<e.length;s++)setTimeout(()=>{t.append(document.createTextNode(e[s])),t.append(document.createElement("br"))},s*500);setTimeout(()=>{t.remove(),this.blocks--},1500)}};return I(O);})();
