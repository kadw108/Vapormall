"use strict";var vapormall=(()=>{var f=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var _=(i,e)=>{for(var s in e)f(i,s,{get:e[s],enumerable:!0})},D=(i,e,s,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of N(e))!y.call(i,l)&&l!==s&&f(i,l,{get:()=>e[l],enumerable:!(a=A(e,l))||a.enumerable});return i};var b=i=>D(f({},"__esModule",{value:!0}),i);var O={};_(O,{Battle:()=>T,CONSTANTS:()=>t,IndividualSoul:()=>g,SKILL_LIST:()=>u,SOUL_LIST:()=>L});var t;(l=>{let i;(c=>(c.HP="HP",c.OFFENSE="offense",c.DEFENSE="defense",c.GLITCHOFFENSE="glitch offense",c.GLITCHDEFENSE="glitch defense",c.SPEED="speed"))(i=l.STATS||={});let e;(S=>(S[S.NORMALDAMAGE=0]="NORMALDAMAGE",S[S.GLITCHDAMAGE=1]="GLITCHDAMAGE",S[S.STATUS=2]="STATUS"))(e=l.SKILLCATEGORIES||={});let s;(c=>(c.TYPELESS="typeless",c.SWEET="sweet",c.EDGE="edge",c.CORPORATE="corporate",c.SANGFROID="sangfroid",c.ERROR="error"))(s=l.TYPES||={});let a;(o=>(o[o.SELECTED=0]="SELECTED",o[o.OPPOSING=1]="OPPOSING",o[o.ALLIED=2]="ALLIED",o[o.ALLY=3]="ALLY",o[o.ALL=4]="ALL",o[o.SELF=5]="SELF",o[o.NONE=6]="NONE"))(a=l.TARGETS||={})})(t||={});var u={basic_attack:{name:"Attack",description:"Basic attack.",power:4,max_pp:30,priority:0,stat_changes:[],target:t.TARGETS.SELECTED,type:t.TYPES.TYPELESS,meta:{category:t.SKILLCATEGORIES.NORMALDAMAGE,crit_rate:0,drain:0,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}},dazzling_polish:{name:"Dazzling Polish",description:"Polish simulated aesthetics for enhanced beauty. Raise Offense, Glitch Offense.",power:null,max_pp:15,priority:0,stat_changes:[{change:1,stat:t.STATS.OFFENSE,target:t.TARGETS.SELF},{change:1,stat:t.STATS.GLITCHOFFENSE,target:t.TARGETS.SELF}],target:t.TARGETS.SELF,type:t.TYPES.SWEET,meta:{category:t.SKILLCATEGORIES.STATUS,crit_rate:0,drain:0,healing:0,max_hits:null,max_turns:null,min_hits:null,min_turns:null}}};var L={Adware:{name:"ADWARE",description:"Churning glut of incoherence.",stats:{[t.STATS.HP]:20,[t.STATS.OFFENSE]:10,[t.STATS.DEFENSE]:10,[t.STATS.GLITCHOFFENSE]:10,[t.STATS.GLITCHDEFENSE]:7,[t.STATS.SPEED]:8},sprites:{front:"temp.gif",back:"temp.gif"},types:[t.TYPES.ERROR],skills:[{skill_meta:u.basic_attack,learned_at:0},{skill_meta:u.dazzling_polish,learned_at:0}]}};var d=class{constructor(e){this.soul=e,this.selected_skill=null,this.selected_target=null,this.infoDiv=document.createElement("div");let s=document.createTextNode(this.soul.name);this.infoDiv.append(s),this.infoDiv.append(document.createElement("br")),this.hpText=document.createElement("small"),this.hpText.append(document.createTextNode(this.getHPString())),this.infoDiv.append(this.hpText),document.getElementById("tophalf")?.append(this.infoDiv),this.stat_changes={[t.STATS.HP]:-1,[t.STATS.OFFENSE]:0,[t.STATS.DEFENSE]:0,[t.STATS.GLITCHOFFENSE]:0,[t.STATS.GLITCHDEFENSE]:0,[t.STATS.SPEED]:0}}updateInfo(){this.hpText.innerHTML=this.getHPString()}getHPString(){return"HP: "+this.soul.currentHP+"/"+this.soul.stats[t.STATS.HP]}calculateStat(e){let s=this.soul.stats[e],a;return this.stat_changes[e]>0?a=(2+this.stat_changes[e])/2:a=2/(2-this.stat_changes[e]),Math.max(Math.floor(s*a),1)}},m=class extends d{constructor(e){super(e),this.infoDiv.classList.add("playerInfo","soulInfo","blackBg")}},E=class extends d{constructor(e){super(e),this.infoDiv.classList.add("enemyInfo","soulInfo","blackBg")}};var h=class{constructor(){let e=document.getElementById("messageContainer");if(e===null){console.error("messageContainer is null! Cannot display messages!");return}this.messageContainer=e,this.blocks=0}enqueueBlock(e){let s=this.blocks*2500;setTimeout(()=>{this.displayBlock(e)},s),this.blocks++}displayBlock(e){let s=document.createElement("div");s.classList.add("message","blackBg"),this.messageContainer.append(s);let a=0;e.forEach((l,n)=>{let r=a*650;typeof l=="string"?(setTimeout(()=>{s.append(document.createTextNode(l)),s.append(document.createElement("br"))},r),a++):setTimeout(()=>{l()},r)}),setTimeout(()=>{s.remove(),this.blocks--},e.length*650-100)}renderSkills(e,s){let a=[],l=document.createElement("div");l.id="skillDiv",e.soul.skills.forEach((n,r)=>{let p=n.renderSkillButton(),S="skill-"+n.data.type;p.classList.add(S),n.pp>0?p.addEventListener("click",s(e,r),!1):p.classList.add("noClick"),l?.append(p)}),document.getElementById("bottomhalf")?.append(l)}temporaryHideSkills(){let e=document.getElementById("skillDiv");e?.classList.add("hidden"),setTimeout(()=>{e?.classList.remove("hidden")},2500*2)}};var T=class i{constructor(e,s){this.playerSouls=e.map(function(l){return new m(l)}),this.enemySouls=s.map(function(l){return new E(l)}),this.souls=[...this.playerSouls,...this.enemySouls],this.battleOver=!1,this.messageRenderer=new h;let a=this.playerSouls[0];this.messageRenderer.renderSkills(a,this.createSkillClickHandler.bind(this))}static getName(e){return e instanceof m?"Your "+e.soul.name:"The opposing "+e.soul.name}passTurn(){function e(a,l){return a.calculateStat(t.STATS.SPEED)-l.calculateStat(t.STATS.SPEED)}let s=this.souls.sort(e);for(let a=0;a<s.length;a++)if(this.useSkill(s[a]),this.checkBattleOver(),this.battleOver)return}checkBattleOver(){let e=!0;for(let a=0;a<this.playerSouls.length;a++)if(this.playerSouls[a].soul.currentHP>0){e=!1;break}e&&(this.messageRenderer.enqueueBlock(["u lose lol"]),this.battleOver=!0);let s=!0;for(let a=0;a<this.enemySouls.length;a++)if(this.enemySouls[a].soul.currentHP>0){s=!1;break}s&&(this.messageRenderer.enqueueBlock(["u win!"]),this.battleOver=!0)}selectEnemySkills(){for(let e of this.enemySouls)e.selected_skill=e.soul.skills[0],e.selected_target=[this.playerSouls[0]]}selectPlayerTarget(e){if(e.selected_skill===null){console.error("SELECTING TARGET FOR NULL PLAYER SKILL");return}switch(e.selected_skill.data.target){case t.TARGETS.SELECTED:case t.TARGETS.OPPOSING:e.selected_target=[this.enemySouls[0]];break;case t.TARGETS.ALLIED:e.selected_target=this.playerSouls;break;case t.TARGETS.ALLY:break;case t.TARGETS.ALL:e.selected_target=this.souls;break;case t.TARGETS.SELF:e.selected_target=[e];break;case t.TARGETS.NONE:e.selected_target=[];break}}createSkillClickHandler(e,s){return()=>{e.selected_skill=e.soul.skills[s],this.messageRenderer.temporaryHideSkills(),this.selectPlayerTarget(e),this.selectEnemySkills(),this.passTurn()}}useSkill(e){let s=e.selected_skill;if(s===null){console.error("Using null skill!");return}if(s.pp<=0){console.error("Using skill with no pp!");return}switch(s.pp--,s.data.target){case t.TARGETS.SELECTED:case t.TARGETS.OPPOSING:case t.TARGETS.ALLIED:case t.TARGETS.ALLY:case t.TARGETS.ALL:case t.TARGETS.SELF:e.selected_target!==null?e.selected_target.forEach(a=>{this.applySkillEffects(e,s,a)}):console.error("No target for move!");break;case t.TARGETS.NONE:break}}applySkillEffects(e,s,a){let l=[i.getName(e)+" used "+s.data.name];switch(l.push(()=>{a.updateInfo()}),s.data.meta.category){case t.SKILLCATEGORIES.NORMALDAMAGE:if(s.data.power!==null){let n=e.calculateStat(t.STATS.OFFENSE)*s.data.power,r=Math.ceil(n/a.calculateStat(t.STATS.DEFENSE));a.soul.currentHP-=r,l.push(i.getName(a)+" lost "+r+" HP!")}break;case t.SKILLCATEGORIES.GLITCHDAMAGE:if(s.data.power!==null){let n=e.calculateStat(t.STATS.GLITCHOFFENSE)*s.data.power,r=Math.ceil(n/a.calculateStat(t.STATS.GLITCHDEFENSE));a.soul.currentHP-=r,l.push(i.getName(a)+" lost "+r+" HP!")}break;case t.SKILLCATEGORIES.STATUS:s.data.stat_changes.forEach(n=>{if(n.stat===t.STATS.HP)console.error("Stat change for HP not allowed!");else if(a.stat_changes[n.stat]===6)l.push(i.getName(a)+"'s "+n.stat+" couldn't go any higher!");else if(a.stat_changes[n.stat]===-6)l.push(i.getName(a)+"'s "+n.stat+" couldn't go any lower!");else{a.stat_changes[n.stat]+=n.change;let r=" ";n.change>0?r+="rose":r+="fell",n.change>1?r+=" "+Math.abs(n.change)+" stages!":r+=" "+Math.abs(n.change)+" stage!",l.push(i.getName(a)+"'s "+n.stat+r)}});break}this.messageRenderer.enqueueBlock(l)}};var k=class{constructor(e){this.data=e,this.pp=e.max_pp}renderSkillButton(){let e=document.createElement("button");e.classList.add("skill-button");let s=document.createTextNode(this.data.name);e.append(s),e.append(document.createElement("br"));let a=document.createElement("small");a.append(document.createTextNode(this.data.type+" ")),e.append(a);let l=document.createElement("small");return l.append(document.createTextNode(this.pp+"/"+this.data.max_pp)),e.append(l),e}},g=class{constructor(e,s){this.soul_species=e,this.name=e.name,this.level=s,this.stats={[t.STATS.HP]:0,[t.STATS.OFFENSE]:0,[t.STATS.DEFENSE]:0,[t.STATS.GLITCHOFFENSE]:0,[t.STATS.GLITCHDEFENSE]:0,[t.STATS.SPEED]:0},this.initializeStats(),this.skills=[],this.initializeSkills()}initializeStats(){for(let e in this.stats){let s=e;this.stats[s]=this.soul_species.stats[s]}this.currentHP=this.stats[t.STATS.HP]}initializeSkills(){for(let e=0;e<this.soul_species.skills.length;e++){let s=this.soul_species.skills[e];s.learned_at<=this.level&&this.skills.push(new k(s.skill_meta))}}};return b(O);})();
